<!DOCTYPE html>
<html lang="en">
    <link rel="stylesheet" href="FavoriteCarparks.css">
    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRg28b9JC7M-Cu6LzKX3VxflWfAaH8a2k&libraries=places" async defer>
    </script>
    <head>
        <div class="title">
            <p>Favorites</p>
        </div>
    </head>
    <body>
        <div id = "favoriteCarparks">
        </div>
    </body>
    <script type = "module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-auth.js";
        const firebaseConfig = {       
            apiKey: "AIzaSyBWImFGqsTT5oRab27BVDjzlicbegDW9qM",
            authDomain: "parkfast-23bd8.firebaseapp.com",
            databaseURL: "https://parkfast-23bd8-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "parkfast-23bd8",
            storageBucket: "parkfast-23bd8.appspot.com",
            messagingSenderId: "333155544674",
            appId: "1:333155544674:web:5cbbd8995095e3cd4c2b3b",
            measurementId: "G-5K5M61GXK1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getDatabase();
        //const userId = auth.currentUser.uid;
        const dbRef = ref(db, '/favorites/hjvCAdABVqXgMmSjWiPrUhRHme73');

        var count = 0;
        onValue(dbRef, (snapshot) => {
        snapshot.forEach((childSnapshot) => {
            count += 1;
            const childData = childSnapshot.val();
            const lat = childData.latitude;
            const lng = childData.longitude;
            var carpark = document.createElement('div');
            carpark.classList.add('location');
            carpark.setAttribute("id", count);
            var carparkLocation = document.createElement('div');
            const latlng = {
            lat: parseFloat(lat),
            lng: parseFloat(lng),
            };
            const geocoder = new google.maps.Geocoder();
            geocoder
            .geocode({ location: latlng })
            .then((response) => {
                if (response.results[0]) {
                    carparkLocation.innerText = response.results[0].formatted_address;
                }
            })
            .catch((e) => window.alert("Geocoder failed due to: " + e));
            carpark.append(carparkLocation);
            var favCarpark = document.getElementById("favoriteCarparks");
            favCarpark.append(carpark);
        });
        }, {
        onlyOnce: true
        });
    </script>
</html>